<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase.js"></script>
    <style media="screen">

        body {
        display: flex;
        min-height: 100vh;
        width: 100%;
        padding: 0;
        margin: 0;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }
        #uploader {
            -webkit-appearance: none;
            appearance: none;
            width: 35%;
            margin-bottom: 10px;

        }
        </style>
</head>

<body>

    <progress value="0" max="100" id="uploader">0%</progress>
    <input type="file" value="upload" id="fileButton" />
    <img src="assets/images/checkmark.gif" id="successful">
    <script type="text/javascript" src="https://sdk.clarifai.com/js/clarifai-latest.js"></script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
    <div>
        <h1><span id="actorDump">Text Goes Here</span></h1>
    </div>


    <script>

        hideStuff()

        function hideStuff() {
            $("#successful").hide()
        }

        //--------------------------------------------------------------------//
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBGjGVTi6NmmYBLwWLfetJ7nYEg7wbBls0",
            authDomain: "celebdata-248e0.firebaseapp.com",
            databaseURL: "https://celebdata-248e0.firebaseio.com",
            projectId: "celebdata-248e0",
            storageBucket: "celebdata-248e0.appspot.com",
            messagingSenderId: "371108570955"
        };

        firebase.initializeApp(config);
        //--------------------------------------------------------------------//
        const database = firebase.database();

        //get elements
        var uploader = document.getElementById('uploader')
        var fileButton = document.getElementById('fileButton')

        //listen for file selection
        var uploadBar = fileButton.addEventListener('change', function (event) {
            //get file
            var file = event.target.files[0]
            //create storage ref
            var storageRef = firebase.storage().ref('celebImages/' + file.name)
            // upload file
            var task = storageRef.put(file)
            // upload progress bar
            task.on('state_changed',

                function progress(snapshot) {
                    var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100
                    uploader.value = percentage
                },

                function error(err) { },

                function complete() {
                    task.snapshot.ref.getDownloadURL().then(function (downloadURL) {
                        console.log('File available at', downloadURL);
                        const app = new Clarifai.App({ apiKey: '724ce3bc62704899808fc73f196edc8a' });
                        app.models.predict("e466caa0619f444ab97497640cefc4dc", downloadURL).then(
                            function (response) {
                                console.log(response)
                                $("#successful").hide()
                                $("#actorDump").text("We are " + ((response.outputs[0].data.regions[0].data.face.identity.concepts[0].value) * 100).toFixed(1) + "% sure it's " + response.outputs[0].data.regions[0].data.face.identity.concepts[0].name)

                            },
                            function (err) {
                                // there was an error
                            }
                        );
                    })
                })

            if (percentage = 100) {
                $("#uploader").hide()
                $("#fileButton").hide()
                $("#successful").show()
            }



        });













    </script>

</body>

</html>